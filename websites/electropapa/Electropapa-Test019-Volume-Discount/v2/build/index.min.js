(()=>{const e={client:"Netzproduzenten",project:"Project Name",site_url:"https://electropapa.com/de",test_name:"Test019 [Electropapa] A/B/C - Followup016 - PDS & Side Cart - Textlink Popup and Volume discount nudge cart",page_initials:"AB-TEST-019",test_variation:2,test_version:5e-4},{page_initials:t,test_variation:n,test_version:i}=e,r=[t,`${t}--v${n}`,`${t}--version-${i}`];function s(e,t,n=2e4,i=150){n<=0?console.warn(`Timeout reached while waiting for condition: ${e.toString()}`):e&&e()?t():setTimeout((()=>s(e,t,n-i,i)),i)}function a(e,t){return t?e.querySelector(t):document.querySelector(e)}function o(e,t){return t?[...e.querySelectorAll(t)]:[...document.querySelectorAll(e)]}function c(e,t){console.log("Triggered convert goal: ",e,t),window._conv_q=window._conv_q||[],_conv_q.push(["triggerConversion",t])}function l(e,t,n){s((()=>a(e)),(()=>{const i=a(e),r=new MutationObserver(t);return r.observe(i,n),r}))}function d(e){return e?parseFloat(e.innerText?.replace(".","")?.replace(",",".")?.replace("€","")):0}function u(e,t=!1){const n=new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(e);return t?n.replaceAll(" ",""):n}async function b(e){const t=a(e,"a.line-item-label")?.getAttribute("href")||"",n=d(a(e,".line-item-total-price-value")),i=+a(e,"input.quantity-selector-group-input")?.value||0,r=await async function(e){return fetch(e).then((e=>e.text())).then((e=>{const t=(new DOMParser).parseFromString(e,"text/html").querySelector(".product-detail-price");if(t)return d(t);throw new Error("Price element not found")}))}(t)*i;return{totalPrice:r,offerPrice:n,discount:r-n,quantity:i}}function p({targetNode:e,totalPrice:t,quantity:n,discount:i,offerPrice:r}){!a(e,".ab-single-item-progress-btn-container")&&n<2&&(a(e,".line-item-quantity").classList.add("ab-hidden"),a(e,".line-item-remove").insertAdjacentElement("beforeend",a(e,".line-item-total-price.line-item-price")),e.insertAdjacentHTML("beforeend",'\n            <div class="ab-single-item-progress-btn-container">\n                <div class="ab-single-item-progress-btn-container__heading">Jetzt zum Sparpreis immer Ersatz parat haben</div>\n                <div class="ab-single-item-progress-btn-container__progress-bar" step="1">\n                    <div class="ab-single-item-progress-btn-container__progress-bar__pointer ab-single-item-progress-btn-container__progress-bar__pointer--2"></div>\n                    <div class="ab-single-item-progress-btn-container__progress-bar__pointer ab-single-item-progress-btn-container__progress-bar__pointer--3"></div>\n                </div>\n                <div class="ab-single-item-progress-btn-container__btn-container">\n                    <div class="ab-single-item-progress-btn-container__btn ab-single-item-progress-btn-container__btn--selected" quantity="1">\n                        <span class="ab-single-item-progress-btn-container__btn__label">1 Stück</span>\n                        <span class="ab-single-item-progress-btn-container__btn__badge"></span>\n                    </div>\n                    <div class="ab-single-item-progress-btn-container__btn" quantity="2">\n                        <span class="ab-single-item-progress-btn-container__btn__label">2 Stück</span>\n                        <span class="ab-single-item-progress-btn-container__btn__badge">Spare 5%</span>\n                    </div>\n                    <div class="ab-single-item-progress-btn-container__btn" quantity="4">\n                        <span class="ab-single-item-progress-btn-container__btn__label">4 Stück</span>\n                        <span class="ab-single-item-progress-btn-container__btn__badge">Spare 6%</span>\n                    </div>\n                </div>\n            </div>\n        ')),!a(e,".ab-celebration-message-container")&&n>1&&(e.insertAdjacentHTML("beforeend",`<div class="ab-celebration-message-container">${function({targetNode:e,totalPrice:t,quantity:n,discount:i,offerPrice:r}){const s=`Glückwunsch! Du sparst ${u(i,!0)} durch unseren Mengenrabatt.`;return n<=1?"<b>Clever sein und sparen:</b>&nbspAb 2 Stück mindestens 5% Rabatt":s}({targetNode:e,totalPrice:t,quantity:n,discount:i,offerPrice:r})}</div>`),n>1&&c("Shows Celebration Message | JS",1004106272))}function g(){o(".offcanvas-cart-items .line-item").forEach((async e=>{const{totalPrice:t,quantity:n,discount:i,offerPrice:r}=await b(e);!function({targetNode:e,totalPrice:t,quantity:n,discount:i,offerPrice:r}){const s=a(e,".line-item-total-price:not(.ab-added-reduced-total)");n>1&&s&&(s.classList.add("ab-added-reduced-total"),s.insertAdjacentHTML("afterbegin",`<div class="ab-total-price ">${u(t)}</div>`))}({targetNode:e,totalPrice:t,quantity:n,discount:i,offerPrice:r}),p({targetNode:e,totalPrice:t,quantity:n,discount:i,offerPrice:r})}))}function m(e,t){e.forEach((e=>{if(e.addedNodes.length>0){const t=Array.from(e.addedNodes).find((e=>1===e.nodeType&&e.classList?.contains("offcanvas-body")));t&&t.querySelector(".offcanvas-cart-items .line-item")&&g()}}))}function _(){return l(".offcanvas",m,{childList:!0,subtree:!0})}function f(e,t){e.forEach((e=>{if(e.addedNodes.length>0){Array.from(e.addedNodes).find((e=>1===e.nodeType&&e.classList?.contains("offcanvas")))&&_()}}))}function v(){window.location.href.includes("/checkout/cart")&&s((()=>o(".checkout-product-table .line-item").length>0&&a(".checkout-aside-summary-list .checkout-aside-summary-value:first-of-type")),(async()=>{const e=o(".checkout-product-table .line-item"),t=await Promise.all(e.map((e=>b(e)))),n=t.reduce(((e,{totalPrice:t})=>e+t),0),i=n-t.reduce(((e,{offerPrice:t})=>e+t),0);0!==i&&(!function(e){a(".checkout-aside-summary-list").insertAdjacentHTML("afterbegin",`<div class="col-12"><div class="ab-total-price">${u(e)}</div></div>`)}(n),function(e){const t=`\n            <div class="col-12">\n                <div class="ab-celebration-message-container ">Glückwunsch! Du sparst ${u(e,!0)} durch unseren Mengenrabatt.</div>\n            </div>\n        `;a(".checkout-aside-summary-list .checkout-aside-summary-value:first-of-type").insertAdjacentHTML("afterend",t)}(i),c("Shows Celebration Message | JS",1004106272))}))}s((function(){return!!document.querySelector(`body:not(.${r[0]}):not(.${r[1]})`)}),(function(){document.body.classList.add(...r),console.table(e),l("body",f,{childList:!0}),_(),document.body.addEventListener("click",(e=>{if(e.target.closest(".ab-single-item-progress-btn-container__btn:not(.ab-single-item-progress-btn-container__btn--selected)")){const t=e.target.closest(".ab-single-item-progress-btn-container__btn:not(.ab-single-item-progress-btn-container__btn--selected)"),n=t.getAttribute("quantity"),i=e.target.closest(".ab-single-item-progress-btn-container");o(i,".ab-single-item-progress-btn-container__btn").forEach((e=>{const n="ab-single-item-progress-btn-container__btn--selected";e===t?e.classList.add(n):e.classList.remove(n)}));const r=a(i,".ab-single-item-progress-btn-container__progress-bar");"1"===n?r.setAttribute("step",1):"2"===n?r.setAttribute("step",2):"4"===n&&r.setAttribute("step",3);const s=a(e.target.closest(".line-item"),".js-offcanvas-cart-change-quantity-number");s.value=n;const c=new Event("change",{bubbles:!0});s.dispatchEvent(c)}if(e.target.closest(".ab-quantity-dropdown-option")){const t=e.target.closest(".ab-quantity-dropdown-option").getAttribute("value");a(".product-detail-quantity-group.quantity-selector-group input.product-detail-quantity-input").value=t}})),v()}))})();
