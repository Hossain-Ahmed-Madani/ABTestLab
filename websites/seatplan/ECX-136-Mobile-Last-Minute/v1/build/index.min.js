(()=>{const e="AB-ECX-136",t=1,n=2e-4;function o(e,t,n=1e4,c=100){try{if(n<=0)throw new Error(`Timeout reached while waiting for condition: ${e.toString()}`);e&&e()?t():setTimeout((()=>{o(e,t,n-c,c)}),c)}catch(e){return void console.warn(e)}}function c(){const e=document.querySelector("#last-minute-day-select").value;document.querySelectorAll(`.sp-table__cell.last-minute__day-col[data-date='${e}']`).forEach((e=>{const t=e.parentNode;"-"===e.querySelector("div").innerText?t.classList.add("ab-hidden"):t.classList.remove("ab-hidden")}))}function i(){const{selectElement:e}=s();e.addEventListener("change",(e=>{c(),console.log("Trigger Goal: ECX-136: Last Minute - Change Date | JS"),window._conv_q=window._conv_q||[],_conv_q.push(["triggerConversion","1004103971"]),function(){const{getCurrentOptionElement:e,getTotalOptions:t,getCurrentOptionIndex:n}=s(),o=document.querySelector(".ab-last-minute__date-heading");o.innerText=e().innerText,o.setAttribute("value",e().value),document.querySelectorAll(".ab-last-minute__button").forEach((e=>{e.classList.remove("ab-last-minute__button--disabled"),(0===n()&&e.querySelector(".sp-icon-chevron-left")||n()===t()-1&&e.querySelector(".sp-icon-chevron-right"))&&e.classList.add("ab-last-minute__button--disabled")}))}()}))}function s(){const e=document.querySelector("#last-minute-day-select");function t(){return document.querySelector(`#last-minute-day-select option[value='${e.value}']`)}function n(t){document.querySelectorAll("#last-minute-day-select option").forEach((e=>e.removeAttribute("selected"))),e.value=t.value,e.selectedIndex=t.index,t.setAttribute("selected","selected");const n=new Event("change",{bubbles:!0});e.dispatchEvent(n)}return{selectElement:e,getCurrentOptionElement:t,getCurrentOptionIndex:function(){return e.selectedIndex},getTotalOptions:function(){return e.options.length},dispatchOnchangeEvent:n,selectPreviousDate:function(){const e=t();e.previousElementSibling&&n(e.previousElementSibling)},selectNextDate:function(){const e=t();e.nextElementSibling&&n(e.nextElementSibling)},selectSecondDate:function(){n(document.querySelector("#last-minute-day-select option:nth-child(2)"))}}}function l(){const{hour:e,timeString:t}=function(){const e=new Intl.DateTimeFormat("en-GB",{timeZone:"Europe/London",hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"}).formatToParts(new Date),t=Object.fromEntries(e.map((({type:e,value:t})=>[e,t])));return{hour:parseInt(t.hour,10),timeString:`${t.hour}:${t.minute}:${t.second}`}}();return{isBetween:e>=19&&e<=23,londonTimeString:t}}o((function(){return!!(window.location.href.includes("whats-on/last-minute/")&&document.querySelector(`body:not(.${e}):not(${e}--v${t})`)&&document.querySelector(".last-minute__date-select #last-minute-day-select")&&document.querySelector(".sp-table__row.last-minute__table-row"))}),(function(){document.body.classList.add(e,`${e}--v${t}`,`${e}--version-${n}`),function(){const e=document.querySelector("#last-minute-day-select");document.querySelector(".last-minute__date-select").insertAdjacentHTML("afterend",`\n                <div class="ab-last-minute">\n                    <button class="ab-last-minute__button ab-last-minute__button--disabled">\n                        <span class="ab-last-minute__button-icon sp-icon sp-icon-chevron-left"></span>\n                    </button>\n                    <div class="ab-last-minute__date-heading" value="${e.value}">${e.querySelector("option[selected]").innerText}</div>\n                    <button class="ab-last-minute__button">\n                        <span class="ab-last-minute__button-icon sp-icon sp-icon-chevron-right"></span>\n                    </button>\n                </div>\n            `)}(),function(){const{selectNextDate:e,selectPreviousDate:t}=s();document.querySelectorAll(".ab-last-minute__button").forEach((n=>{const o=n.querySelector(".sp-icon-chevron-left")?"prev":"next";n.addEventListener("click",(n=>{"prev"===o?t():"next"===o&&e()}))}))}(),c(),i(),o((()=>"complete"===document.readyState),(()=>{const e=l(),{selectSecondDate:t}=s();e.isBetween&&t()}))}))})();
